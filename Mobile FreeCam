local gui = Instance.new("ScreenGui")
gui.Name = "FreecamGUI"
gui.ResetOnSpawn = false
gui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

local toggle = Instance.new("TextButton")
toggle.Name = "Toggle"
toggle.Size = UDim2.new(0,120,0,40)
toggle.Position = UDim2.new(0,10,0,10)
toggle.BackgroundColor3 = Color3.fromRGB(255,255,255)
toggle.BackgroundTransparency = 0.2
toggle.Text = "Off"
toggle.Parent = gui

local kill = Instance.new("TextButton")
kill.Name = "KillSwitch"
kill.Size = UDim2.new(0,120,0,40)
kill.Position = UDim2.new(0,10,0,60)
kill.BackgroundColor3 = Color3.fromRGB(255,50,50)
kill.BackgroundTransparency = 0.2
kill.Text = "Kill"
kill.Parent = gui

local function round(b)
	local c = Instance.new("UICorner")
	c.CornerRadius = UDim.new(1,0)
	c.Parent = b
end

round(toggle)
round(kill)

local db = false
local cam = workspace.CurrentCamera
local rs = game:GetService("RunService")
local uis = game:GetService("UserInputService")

local moving = {Up=false,Down=false,Left=false,Right=false}

local up = Instance.new("TextButton")
local down = Instance.new("TextButton")
local left = Instance.new("TextButton")
local right = Instance.new("TextButton")

local sliderX = Instance.new("TextBox")
local sliderY = Instance.new("TextBox")
local sliderZ = Instance.new("TextBox")

local labelX = Instance.new("TextLabel")
local labelY = Instance.new("TextLabel")
local labelZ = Instance.new("TextLabel")

local freecamPart
local rotationX = 0
local rotationY = 0
local rotationZ = 0
local activeTouch = nil
local lastPos = nil
local speed = 1

local function makeButton(btn,text,pos)
	btn.Text = text
	btn.BackgroundColor3 = Color3.fromRGB(255,255,255)
	btn.BackgroundTransparency = 0.4
	btn.Size = UDim2.new(0.1,0,0.1,0)
	btn.Position = pos
	btn.Parent = gui
	round(btn)
end

local function makeTextbox(tb,pos)
	tb.ClearTextOnFocus = false
	tb.BackgroundColor3 = Color3.fromRGB(255,255,255)
	tb.BackgroundTransparency = 0.2
	tb.Size = UDim2.new(0,80,0,30)
	tb.Position = pos
	tb.Text = "0"
	tb.Parent = gui
	round(tb)
end

local function makeLabel(lbl,text,pos)
	lbl.BackgroundTransparency = 1
	lbl.Text = text
	lbl.Size = UDim2.new(0,20,0,30)
	lbl.Position = pos
	lbl.TextXAlignment = Enum.TextXAlignment.Left
	lbl.Parent = gui
end

local function clamp(v)
	if v > 360 then return 360 end
	if v < -360 then return -360 end
	return v
end

local function applyTextbox()
	local x = tonumber(sliderX.Text)
	local y = tonumber(sliderY.Text)
	local z = tonumber(sliderZ.Text)
	if x then rotationX = clamp(x) end
	if y then rotationY = clamp(y) end
	if z then rotationZ = clamp(z) end
end

local function isInsideGui(pos)
	local guiObjects = gui:GetDescendants()
	for _,obj in ipairs(guiObjects) do
		if obj:IsA("GuiObject") then
			local abs = obj.AbsolutePosition
			local size = obj.AbsoluteSize
			if pos.X >= abs.X and pos.X <= abs.X + size.X and pos.Y >= abs.Y and pos.Y <= abs.Y + size.Y then
				return true
			end
		end
	end
	return false
end

local function startTouch(id,pos)
	if activeTouch then return end
	if isInsideGui(Vector2.new(pos.X,pos.Y)) then return end
	activeTouch = id
	lastPos = Vector2.new(pos.X,pos.Y)
end

local function moveTouch(id,pos)
	if id ~= activeTouch or not lastPos then return end
	local p = Vector2.new(pos.X,pos.Y)
	local d = p - lastPos
	rotationY = clamp(rotationY - d.X * 0.3)
	rotationX = math.clamp(rotationX - d.Y * 0.3,-89,89)
	lastPos = p
end

local function endTouch(id)
	if id == activeTouch then
		activeTouch = nil
		lastPos = nil
	end
end

toggle.MouseButton1Click:Connect(function()

	if db then
		db = false
		toggle.Text = "Off"
		up.Parent = nil
		down.Parent = nil
		left.Parent = nil
		right.Parent = nil
		sliderX.Parent = nil
		sliderY.Parent = nil
		sliderZ.Parent = nil
		labelX.Parent = nil
		labelY.Parent = nil
		labelZ.Parent = nil
		rs:UnbindFromRenderStep("FreecamMove")
		if freecamPart then freecamPart:Destroy() end
		freecamPart = nil
		cam.CameraType = Enum.CameraType.Custom
		rotationX,rotationY,rotationZ = 0,0,0
		return
	end

	db = true
	toggle.Text = "On"

	freecamPart = Instance.new("Part")
	freecamPart.Size = Vector3.new(1,1,1)
	freecamPart.Anchored = true
	freecamPart.Transparency = 1
	freecamPart.CanCollide = false
	freecamPart.CFrame = cam.CFrame
	freecamPart.Parent = workspace

	cam.CameraType = Enum.CameraType.Scriptable

	makeButton(up,"Up",UDim2.new(0.1,0,0.5,0))
	makeButton(down,"Down",UDim2.new(0.1,0,0.7,0))
	makeButton(left,"Left",UDim2.new(0.05,0,0.6,0))
	makeButton(right,"Right",UDim2.new(0.15,0,0.6,0))

	up.MouseButton1Down:Connect(function() moving.Up=true end)
	up.MouseButton1Up:Connect(function() moving.Up=false end)
	down.MouseButton1Down:Connect(function() moving.Down=true end)
	down.MouseButton1Up:Connect(function() moving.Down=false end)
	left.MouseButton1Down:Connect(function() moving.Left=true end)
	left.MouseButton1Up:Connect(function() moving.Left=false end)
	right.MouseButton1Down:Connect(function() moving.Right=true end)
	right.MouseButton1Up:Connect(function() moving.Right=false end)

	makeTextbox(sliderX,UDim2.new(0.85,0,0.30,0))
	makeTextbox(sliderY,UDim2.new(0.85,0,0.40,0))
	makeTextbox(sliderZ,UDim2.new(0.85,0,0.50,0))

	makeLabel(labelX,"X",UDim2.new(0.80,0,0.30,0))
	makeLabel(labelY,"Y",UDim2.new(0.80,0,0.40,0))
	makeLabel(labelZ,"Z",UDim2.new(0.80,0,0.50,0))

	sliderX.FocusLost:Connect(applyTextbox)
	sliderY.FocusLost:Connect(applyTextbox)
	sliderZ.FocusLost:Connect(applyTextbox)

	uis.TouchStarted:Connect(function(t)
		startTouch(t.TouchId,t.Position)
	end)

	uis.TouchMoved:Connect(function(t)
		moveTouch(t.TouchId,t.Position)
	end)

	uis.TouchEnded:Connect(function(t)
		endTouch(t.TouchId)
	end)

	rs:BindToRenderStep("FreecamMove",Enum.RenderPriority.Camera.Value,function()
		local cf = freecamPart.CFrame
		local dir = Vector3.zero

		if moving.Up then dir += cf.LookVector*speed end
		if moving.Down then dir -= cf.LookVector*speed end
		if moving.Left then dir -= cf.RightVector*speed end
		if moving.Right then dir += cf.RightVector*speed end

		freecamPart.CFrame =
			CFrame.new(freecamPart.Position + dir)
			* CFrame.Angles(
				math.rad(rotationX),
				math.rad(rotationY),
				math.rad(rotationZ)
			)

		cam.CFrame = freecamPart.CFrame

		if not sliderX:IsFocused() then sliderX.Text = tostring(math.floor(rotationX)) end
		if not sliderY:IsFocused() then sliderY.Text = tostring(math.floor(rotationY)) end
		if not sliderZ:IsFocused() then sliderZ.Text = tostring(math.floor(rotationZ)) end
	end)
end)

kill.MouseButton1Click:Connect(function()
	gui:Destroy()
	if freecamPart then freecamPart:Destroy() end
	rs:UnbindFromRenderStep("FreecamMove")
	cam.CameraType = Enum.CameraType.Custom
end)
